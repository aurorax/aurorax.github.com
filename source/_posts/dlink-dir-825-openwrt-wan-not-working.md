title: dlink dir-825刷入openwrt及wan口不工作
tags:
  - '825'
  - b
  - dir
  - dlink
  - openwrt
  - wan
  - 不工作
  - 刷入
id: 816
categories:
  - Web
date: 2014-10-30 12:01:37
---

版本是dlink dir-825 B版。
官方wiki:
[http://wiki.openwrt.org/toh/d-link/dir-825](http://wiki.openwrt.org/toh/d-link/dir-825)
到手的固件版本貌似是2.05EA(East Asia?)，记不太清楚了，这个版本是不能直接通过“固件升级”刷入固件的，需要使用恢复模式。
进入恢复模式的方法，按住reset上电大概20秒左右，电源灯闪烁，闪烁间隔大概1s，配置固定ip在192.168.0.0/24网段访问192.168.0.1即可进入，如不成功可以尝试接入lan口，或尝试30-30-30大法，即一直按住reset上电30秒-断电30秒-再上电30秒。
然后是刷入固件，有人说必须要ie7刷入，也有人说和浏览器无关，需要把网口设置为百兆半双工，总之825是一台很匪夷所思的路由，随机性很强，我的刷入过程是网口设置为百兆半双工（隐约记得设置为自适应也成功过），使用firefox浏览器，刷入固件后浏览器没响应，也没有出现官方所说的进度条和100%，等待一段时就按以后闪烁的电源灯熄灭，一段时间后常亮，然后配置网段192.168.1.0/24，访问192.168.1.1即可登录。
dir825另外一个很匪夷所思的地方是它的wan口不支持千兆，或者说它本来就是个百兆口？没有拆机不置可否，在刷入官方固件的情况下，上级接入千兆交换机，得到的信息是这个接口只有百兆。总之想要使用wan口就要通过各种办法把它设置为百兆，最简单的办法是wan口上接一台百兆路由器或交换机。
要设置wan口默认速率可以使用ethtool，首先要通过各种办法让路由联网，可以wan口连接上级百兆路由，或lan口接路由或交换机并配置到同网段，然后在system-&gt;software下更新软件列表，找到ethtool并install，然后ssh登陆路由运行：

	$ ethtool -s eth1 autoneg off speed 100 duplex full

以上语句为：设置eth1口关闭端口自适应，速率百兆，全双工。还要把这句写入/etc/rc.local文件exit 0语句之前，使其每次启动都自动设置。
现在这个路由已经可以正常使用了。